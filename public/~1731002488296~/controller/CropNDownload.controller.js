sap.ui.define(["./util/BaseController"],function(t){"use strict";return t.extend("com.perezjquim.ytc.pwa.controller.CropNDownload",{API_BASE_URL:"https://perezjquim-ytc.herokuapp.com",onPrepareVideo:async function(){this.setBusy(true);const t=this.byId("ytc-wizard");const e=this.getModel("prompt");const o=e.getProperty("/split");var n=[];try{const r=decodeURIComponent(e.getProperty("/url"));const c=e.getProperty("/start_time");const a=e.getProperty("/end_time");if(o){const t=new Date(`1970-01-01 00:${c}`);const o=new Date(`1970-01-01 00:${a}`);const i=e.getProperty("/split_interval");const l=new Date(`1970-01-01 00:${i}`);const d=Number(l.getMinutes());const u=Number(l.getSeconds());while(true){const e=`${t.getMinutes()}:${t.getSeconds()}`;t.setMinutes(t.getMinutes()+d);t.setSeconds(t.getSeconds()+u);var s="";if(t.getTime()<o.getTime()){s=`${t.getMinutes()}:${t.getSeconds()}`;n.push(await this._downloadVideo(r,e,s))}else{s=`${o.getMinutes()}:${o.getSeconds()}`;n.push(await this._downloadVideo(r,e,s));break}}}else{n.push(await this._downloadVideo(r,c,a))}const l=await Promise.all(n);const d=this.getModel("video_blobs");var i=[];l.forEach(async function(e){if(e.ok){const t=e.headers.get("content-disposition").split("filename=")[1].split(";")[0];const o=await e.blob();const n=new Blob([o],{type:"application/octet-stream"});const s=window.URL.createObjectURL(n);i=i.concat([{file_name:t,blob_url:s}]);i.sort((t,e)=>t["file_name"]>e["file_name"]?1:-1);d.setData(i)}else{const o=await e.text();console.warn(o);this.toast(o);t.previousStep()}}.bind(this))}catch(e){console.warn(e);this.toast(e);t.previousStep()}this.setBusy(false)},onParamChanged:async function(t){const e=this.byId("ytc-wizard");e.previousStep();const o=this.getModel("video_blobs");o.setData([]);const n=t.getSource();const s=n.getBinding("value")||n.getBinding("selected");const i=s.getPath();switch(i){case"/url":const t=this.getModel("prompt");const e=decodeURIComponent(t.getProperty("/url"));if(e){}else{oVideoInfoModel.setData({})}break;default:break}},onPressDownload:function(t){const e=t.getSource();const o=e.getBindingContext("video_blobs");const n=o.getProperty("file_name");const s=o.getProperty("blob_url");const i=document.createElement("a");i.setAttribute("href",s);i.setAttribute("download",n);i.click()},prepareIframeContent:function(t){if(t){const e=new URL(t);const o=e.searchParams.get("v");return`<iframe \n\t\t\t\t\tsrc='https://www.youtube.com/embed/${o}'\n\t\t\t\t\tframeborder="0"\n\t\t\t\t\tallow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"\n\t\t\t\t\treferrerpolicy="strict-origin-when-cross-origin"\n\t\t\t\t\tallowfullscreen\n\t\t\t\t/>`}},_downloadVideo:async function(t,e,o){const n=(new Date).getTime();const s={url:t,start_time:e,end_time:o};const i=new URLSearchParams(s);const r=decodeURIComponent(i.toString());const c=`${this.API_BASE_URL}/crop-video?${r}&=${n}`;return fetch(c)}})});